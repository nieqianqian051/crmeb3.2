(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-499fa353"],{"023d":function(t,e,r){},"0f0e":function(t,e,r){"use strict";var n=r("c4c8"),a={name:"userLabel",props:{},data:function(){return{labelList:[],dataLabel:[],isUser:!1}},mounted:function(){},methods:{inArray:function(t,e){for(var r in e)if(e[r].id==t)return!0;return!1},userLabel:function(t){var e=this;this.dataLabel=t,Object(n.rb)().then((function(t){t.data.map((function(t){t.children&&t.children.length&&(e.isUser=!0,t.children.map((function(t){e.inArray(t.id,e.dataLabel)?t.disabled=!0:t.disabled=!1})))})),e.labelList=t.data})).catch((function(t){e.$Message.error(t.msg)}))},selectLabel:function(t){if(t.disabled){var e=this.dataLabel.indexOf(this.dataLabel.filter((function(e){return e.id==t.id}))[0]);this.dataLabel.splice(e,1),t.disabled=!1}else this.dataLabel.push({label_name:t.label_name,id:t.id,tag_id:t.tag_id}),t.disabled=!0},subBtn:function(){this.$emit("activeData",JSON.parse(JSON.stringify(this.dataLabel)))},cancel:function(){this.$emit("close")}}},o=(r("b0ee"),r("2877")),i=Object(o.a)(a,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"label-wrapper"},[r("div",{staticClass:"list-box"},[t._l(t.labelList,(function(e,n){return r("div",{directives:[{name:"show",rawName:"v-show",value:t.isUser,expression:"isUser"}],key:n,staticClass:"label-box"},[e.children&&e.children.length?r("div",{staticClass:"title"},[t._v("\n        "+t._s(e.label_name)+"\n      ")]):t._e(),e.children&&e.children.length?r("div",{staticClass:"list"},t._l(e.children,(function(e,n){return r("div",{key:n,staticClass:"label-item",class:{on:e.disabled},on:{click:function(r){return t.selectLabel(e)}}},[t._v("\n          "+t._s(e.label_name)+"\n        ")])})),0):t._e()])})),t.isUser?t._e():r("div",[t._v("暂无标签")])],2),r("div",{staticClass:"footer"},[r("Button",{on:{click:t.cancel}},[t._v("取消")]),r("Button",{staticClass:"ml14",attrs:{type:"primary"},on:{click:t.subBtn}},[t._v("确定")])],1)])}),[],!1,null,"3b9d7c98",null);e.a=i.exports},3739:function(t,e,r){},"4afc":function(t,e,r){"use strict";r.r(e);var n=r("2f62"),a=r("b7be"),o=r("c24f"),i=r("c4c8"),s=r("f1c7"),c=r("0f0e"),l=r("c4ad");function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(){d=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var o=e&&e.prototype instanceof _?e:_,i=Object.create(o.prototype),s=new $(n||[]);return a(i,"_invoke",{value:S(t,r,s)}),i}function m(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var p="suspendedStart",h="suspendedYield",b="executing",v="completed",g={};function _(){}function y(){}function w(){}var k={};l(k,i,(function(){return this}));var x=Object.getPrototypeOf,C=x&&x(x(D([])));C&&C!==r&&n.call(C,i)&&(k=C);var O=w.prototype=_.prototype=Object.create(k);function j(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function L(t,e){function r(a,o,i,s){var c=m(t[a],t,o);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==u(d)&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(d).then((function(t){l.value=t,i(l)}),(function(t){return r("throw",t,i,s)}))}s(c.arg)}var o;a(this,"_invoke",{value:function(t,n){function a(){return new e((function(e,a){r(t,n,e,a)}))}return o=o?o.then(a,a):a()}})}function S(e,r,n){var a=p;return function(o,i){if(a===b)throw Error("Generator is already running");if(a===v){if("throw"===o)throw i;return{value:t,done:!0}}for(n.method=o,n.arg=i;;){var s=n.delegate;if(s){var c=V(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===p)throw a=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=b;var l=m(e,r,n);if("normal"===l.type){if(a=n.done?v:h,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(a=v,n.method="throw",n.arg=l.arg)}}}function V(e,r){var n=r.method,a=e.iterator[n];if(a===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,V(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var o=m(a,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,g;var i=o.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function $(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function D(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function r(){for(;++a<e.length;)if(n.call(e,a))return r.value=e[a],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(u(e)+" is not iterable")}return y.prototype=w,a(O,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:y,configurable:!0}),y.displayName=l(w,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,l(t,c,"GeneratorFunction")),t.prototype=Object.create(O),t},e.awrap=function(t){return{__await:t}},j(L.prototype),l(L.prototype,s,(function(){return this})),e.AsyncIterator=L,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new L(f(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},j(O),l(O,c,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=D,$.prototype={constructor:$,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(n,a){return s.type="throw",s.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(c&&l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;P(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:D(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function f(t,e,r,n,a,o,i){try{var s=t[o](i),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,a)}function m(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function p(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?m(Object(r),!0).forEach((function(e){h(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function h(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=u(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==u(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var b={name:"index",props:{goodsType:{type:Number,default:0},is_new:{type:String,default:""},diy:{type:Boolean,default:!1},isdiy:{type:Boolean,default:!1},ischeckbox:{type:Boolean,default:!1},datas:{type:Object,default:function(){return{}}}},data:function(){return{labelSelect:[],cateIds:[],treeSelect:[],formValidate:{page:1,limit:10,cate_id:"",store_name:"",is_new:this.is_new,store_label_id:""},total:0,loading:!1,grid:{xl:10,lg:10,md:12,sm:24,xs:24},tableList:[],currentid:0,productRow:{},images:[]}},computed:p(p({},Object(n.e)("admin/layout",["isMobile"])),{},{labelWidth:function(){return this.isMobile?void 0:120},labelPosition:function(){return this.isMobile?"top":"right"}}),created:function(){},mounted:function(){this.goodsCategory(),this.getList(),this.getAllLabelApi()},methods:{getAllLabelApi:function(){var t=this;Object(i.b)().then((function(e){t.labelSelect=e.data})).catch((function(e){t.$Message.error(e.msg)}))},goodsCategory:function(){var t=this;Object(i.h)(1).then((function(e){t.treeSelect=e.data})).catch((function(e){t.$Message.error(e.msg)}))},pageChange:function(t){var e=t.currentPage,r=t.pageSize;this.formValidate.page=e,this.formValidate.limit=r,this.getList()},getList:function(){var t=this;this.loading=!0,this.goodsType&&(this.formValidate.is_presale_product=0,this.formValidate.is_vip_product=0),this.formValidate.cate_id=this.cateIds[this.cateIds.length-1],Object(i.i)(this.formValidate).then(function(){var e,r=(e=d().mark((function e(r){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=r.data.list).forEach((function(t){t.attrValue.forEach((function(e){e.store_name=e.suk,e.cate_name=t.cate_name,e.store_label=t.store_label}))})),t.tableList=n,t.total=r.data.count,t.loading=!1;case 5:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(t){f(o,n,a,i,s,"next",t)}function s(t){f(o,n,a,i,s,"throw",t)}i(void 0)}))});return function(t){return r.apply(this,arguments)}}()).catch((function(e){t.loading=!1,t.$Message.error(e.msg)}))},ok:function(){var t=[];this.$refs.xTree.getCheckboxRecords().forEach((function(e){e.hasOwnProperty("product_id")&&t.push(e)})),t.length>0?this.$emit("getProductId",t):this.$Message.warning("请先选择商品")},treeSearchs:function(t){this.cateIds=t,this.formValidate.page=1,this.getList()},userSearchs:function(){this.formValidate.page=1,this.getList()},clear:function(){this.productRow.id="",this.currentid=""}}},v=(r("b3cf"),r("2877")),g=Object(v.a)(b,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"goodList"},[r("Form",{ref:"formValidate",staticClass:"tabform",attrs:{model:t.formValidate,"label-width":t.labelWidth,"label-position":t.labelPosition}},[r("Row",{attrs:{type:"flex",gutter:24}},[r("Col",t._b({},"Col",t.grid,!1),[r("FormItem",{attrs:{label:"商品分类：","label-for":"pid"}},[r("Cascader",{directives:[{name:"width",rawName:"v-width",value:"200px",expression:"'200px'"}],attrs:{data:t.treeSelect,placeholder:"请选择商品分类","change-on-select":"",filterable:""},on:{"on-change":t.treeSearchs}})],1)],1),r("Col",t._b({},"Col",t.grid,!1),[r("FormItem",{attrs:{label:"商品标签：","label-for":"pid"}},[r("Select",{staticClass:"width20",attrs:{clearable:""},on:{"on-change":t.userSearchs},model:{value:t.formValidate.store_label_id,callback:function(e){t.$set(t.formValidate,"store_label_id",e)},expression:"formValidate.store_label_id"}},t._l(t.labelSelect,(function(e){return r("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.label_name)+"\n\t\t\t\t\t")])})),1)],1)],1),r("Col",t._b({},"Col",t.grid,!1),[r("FormItem",{attrs:{label:"商品搜索：","label-for":"store_name"}},[r("Input",{staticStyle:{width:"240px"},attrs:{search:"","enter-button":"",placeholder:"请输入商品名称,关键字,编号"},on:{"on-search":t.userSearchs},model:{value:t.formValidate.store_name,callback:function(e){t.$set(t.formValidate,"store_name",e)},expression:"formValidate.store_name"}})],1)],1)],1)],1),r("div",{staticClass:"vxeTable"},[r("vxe-table",{ref:"xTree",attrs:{border:"inner","column-config":{resizable:!0},"row-id":"id","tree-config":{children:"attrValue",reserve:!0},data:t.tableList,"max-height":"400","checkbox-config":{reserve:!0}}},[r("vxe-column",{attrs:{type:"checkbox",title:"多选",width:"90","tree-node":""}}),r("vxe-column",{attrs:{field:"id",title:"商品ID",width:"80"}}),r("vxe-column",{attrs:{field:"image",title:"图片","min-width":"90"},scopedSlots:t._u([{key:"default",fn:function(t){var e=t.row;return[r("viewer",[r("div",{staticClass:"tabBox_img"},[r("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.image,expression:"row.image"}]})])])]}}])}),r("vxe-column",{attrs:{field:"store_name",title:"商品名称","min-width":"190"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("Tooltip",{attrs:{"max-width":"500",placement:"bottom"}},[r("span",{staticClass:"line2"},[t._v(t._s(n.store_name))]),r("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(n.store_name))])])]}}])}),r("vxe-column",{attrs:{field:"product_type",title:"商品类型","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[0==n.product_type?r("span",[t._v("普通商品")]):t._e(),1==n.product_type?r("span",[t._v("卡密商品")]):t._e(),3==n.product_type?r("span",[t._v("虚拟商品")]):t._e(),4==n.product_type?r("span",[t._v("次卡商品")]):t._e()]}}])}),r("vxe-column",{attrs:{field:"cate_name",title:"商品分类","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("Tooltip",{attrs:{"max-width":"200",placement:"bottom"}},[r("span",{staticClass:"line2"},[t._v(t._s(n.cate_name))]),r("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(n.cate_name))])])]}}])}),r("vxe-column",{attrs:{field:"store_label",title:"商品标签","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("Tooltip",{attrs:{"max-width":"500",placement:"bottom"}},[r("span",{staticClass:"line2"},[t._v(t._s(n.store_label))]),r("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(n.store_label))])])]}}])})],1),r("vxe-pager",{attrs:{border:"",size:"medium","page-size":t.formValidate.limit,"current-page":t.formValidate.page,total:t.total,layouts:["PrevPage","JumpNumber","NextPage","FullJump","Total"]},on:{"page-change":t.pageChange}})],1),r("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[r("Button",{attrs:{type:"primary",size:"large",long:""},on:{click:t.ok}},[t._v("提交")])],1)],1)}),[],!1,null,"1b422609",null).exports,_=r("e449"),y=r("ed08");function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function k(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function x(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?k(Object(r),!0).forEach((function(e){C(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function C(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=w(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==w(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var O={name:"addPiecesDiscount",components:{userLabel:c.a,goodsList:l.default,goodsAttr:g,couponList:_.a,storeLabelList:s.a},data:function(){var t=this;return{storeDataLabel:[],storeLabelShow:!1,props:{emitPath:!1,multiple:!0},brandData:[],grid:{xl:7,lg:7,md:12,sm:24,xs:24},sattrModals:!1,modals:!1,tableData:[],headTab:[{name:"基础设置",type:"1"},{name:"添加商品",type:"2"}],discountType:[{name:"满N元",title:"例：满100元送小样",id:1},{name:"满N件",title:"例：满3件送小样",id:2}],activityType:[{name:"优惠券",type:"5"},{name:"满减满折",type:"3"},{name:"第N件N折",type:"2"},{name:"限时折扣",type:"1"}],currentTab:"1",dataLabel:[],labelShow:!1,formValidate:{name:"",section_time:[],is_label:0,label_id:[],is_overlay:"0",overlay:[],product_partake_type:1,product_id:[],threshold_type:1,promotions_cate:"1",promotions:[],brand_id:[],store_label_id:[]},promotionsData:[{threshold:0,give_integral:0,checkIntegral:!1,checkCoupon:!1,checkGoods:!1,giveProducts:[],giveCoupon:[]}],indexCoupon:0,indexGoods:0,ruleValidate:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],section_time:[{required:!0,type:"array",message:"请选择活动时间",trigger:"change"}],promotions_cate:[{required:!0,message:"请设置满送方式",trigger:"change"}],is_overlay:[{required:!0,message:"请设置优惠叠加",trigger:"change"}]},columns:[{title:"优惠券名称",key:"title",minWidth:150},{title:"类型",slot:"coupon_type",minWidth:80},{title:"面值",slot:"coupon_price",minWidth:100},{title:"最低消费额",key:"use_min_price",minWidth:100},{title:"限量",key:"limit_num",width:120,render:function(e,r){return e("div",[e("InputNumber",{props:{value:r.row.limit_num,placeholder:"请输入",precision:0,min:0},on:{"on-change":function(e){r.row.limit_num=e,t.promotionsData[r.row.indexCoupon].giveCoupon[r.index].limit_num=e}}})])}},{title:"操作",slot:"status",align:"center",minWidth:80}],colGoods:[{title:"商品信息",slot:"info",minWidth:200},{title:"售价",key:"price",minWidth:80},{title:"库存",key:"stock",minWidth:80},{title:"单次赠送",key:"onceNum",minWidth:80},{title:"总数量",key:"limit_num",width:120,render:function(e,r){return e("div",[e("InputNumber",{props:{value:r.row.limit_num,placeholder:"请输入",precision:0,min:0},on:{"on-change":function(e){r.row.limit_num=e,t.promotionsData[r.row.indexGoods].giveProducts[r.index].limit_num=e}}})])}},{title:"操作",slot:"status",align:"center",minWidth:80}]}},computed:x(x({},Object(n.e)("admin/layout",["isMobile","menuCollapse"])),{},{labelWidth:function(){return this.isMobile?void 0:90},labelPosition:function(){return this.isMobile?"top":"right"},labelBottom:function(){return this.isMobile?void 0:15}}),created:function(){},mounted:function(){this.setCopyrightShow({value:!1}),0!=this.$route.params.id&&this.getDiscountInfo()},destroyed:function(){this.setCopyrightShow({value:!0})},methods:x(x({},Object(n.d)("admin/layout",["setCopyrightShow"])),{},{closeStoreLabel:function(t){var e=this.storeDataLabel.indexOf(this.storeDataLabel.filter((function(e){return e.id==t.id}))[0]);this.storeDataLabel.splice(e,1)},openStoreLabel:function(){this.storeLabelShow=!0,this.$refs.storeLabel.storeLabel(JSON.parse(JSON.stringify(this.storeDataLabel)))},activeStoreData:function(t){this.storeLabelShow=!1,this.storeDataLabel=t},storeLabelClose:function(){this.storeLabelShow=!1},goodTap:function(t){4==t&&this.getBrandList()},getBrandList:function(){var t=this;Object(i.f)().then((function(e){t.brandData=e.data})).catch((function(e){t.$Message.error(e.msg)}))},changeFull:function(){this.promotionsData=[],this.addLevel()},addLevel:function(){this.promotionsData.push({threshold:0,give_integral:0,checkIntegral:!1,checkCoupon:!1,checkGoods:!1,giveProducts:[],giveCoupon:[]})},delCoupon:function(t,e){this.promotionsData[e].giveCoupon.splice(t,1)},delGoods:function(t,e){this.promotionsData[e].giveProducts.splice(t,1)},getCouponList:function(t){var e=this.indexCoupon;this.$refs.couponTemplates.isTemplate=!1,t.forEach((function(t){t.limit_num=0,t.indexCoupon=e}));var r=this.promotionsData[e].giveCoupon.concat(t),n=this.unique(r);this.promotionsData[e].giveCoupon=n},addCoupon:function(t){this.indexCoupon=t,this.$refs.couponTemplates.isTemplate=!0,this.$refs.couponTemplates.tableList()},discountTypeTap:function(t){this.formValidate.threshold_type=t.id,2==t.id&&this.promotionsData.forEach((function(t){t.threshold=0}))},getDiscountInfo:function(){var t=this;Object(a.z)(this.$route.params.id).then((function(e){t.formValidate=e.data.info,t.formValidate.promotions_cate=t.formValidate.promotions_cate.toString(),t.formValidate.is_overlay=t.formValidate.is_overlay.toString(),t.tableData=e.data.info.products,t.dataLabel=e.data.info.label_id,t.storeDataLabel=e.data.info.store_label_id,4==e.data.info.product_partake_type&&t.getBrandList();var r=e.data.info.promotions;r.forEach((function(t,e){t.checkCoupon=!!t.giveCoupon.length,t.checkGoods=!!t.giveProducts.length,t.checkIntegral=parseFloat(t.give_integral)>0,t.giveCoupon.forEach((function(t){t.indexCoupon=e})),t.giveProducts.forEach((function(t){t.indexGoods=e,t.onceNum=1}))})),t.promotionsData=r})).catch((function(e){t.$Message.error(e.msg)}))},del:function(t){var e=this;this.tableData.forEach((function(r,n){if(t.id==r.id)return e.tableData.splice(n,1);r.attrValue.forEach((function(a,o){if(t.id==a.id)return 1==r.attrValue.length?e.tableData.splice(n,1):r.attrValue.splice(o,1)}))}))},addLabel:function(){this.$modalForm(Object(o.V)(0)).then((function(){}))},addGoods:function(t){this.modals=!0},addGoodsSattr:function(t){this.sattrModals=!0,this.indexGoods=t},cancel:function(){this.modals=!1},unique:function(t){var e=new Map;return t.filter((function(t){return!e.has(t.id)&&e.set(t.id,1)}))},getProductId:function(t){this.modals=!1;var e=this.tableData.concat(t),r=this.unique(e);r.forEach((function(t){t.attrValue.forEach((function(e){e.cate_name=t.cate_name,e.store_label=t.store_label}))})),this.tableData=r},getAtterId:function(t){this.sattrModals=!1;var e=this.indexGoods;t.forEach((function(t){t.limit_num=0,t.indexGoods=e,t.onceNum=1}));var r=this.promotionsData[e].giveProducts.concat(t),n=this.unique(r);this.promotionsData[e].giveProducts=n},onchangeTime:function(t){this.formValidate.section_time=t},closeLabel:function(t){var e=this.dataLabel.indexOf(this.dataLabel.filter((function(e){return e.id==t.id}))[0]);this.dataLabel.splice(e,1)},activeData:function(t){this.labelShow=!1,this.dataLabel=t},openLabel:function(t){this.labelShow=!0,this.$refs.userLabel.userLabel(JSON.parse(JSON.stringify(this.dataLabel)))},labelClose:function(){this.labelShow=!1},delGrade:function(t){this.promotionsData.splice(t,1)},upTab:function(){1==this.currentTab&&0!=this.formValidate.product_type?this.currentTab=(Number(this.currentTab)-2).toString():this.currentTab=(Number(this.currentTab)-1).toString()},downTab:function(t){var e=this;this.$refs[t].validate((function(t){if(t){if(e.formValidate.is_label&&!e.dataLabel.length)return e.$Message.warning("请选择用户关联标签");if(parseInt(e.formValidate.is_overlay)&&!e.formValidate.overlay.length)return e.$Message.warning("请选择叠加的营销活动");if(""==e.formValidate.section_time[0])return e.$Message.warning("请选择活动时间");e.currentTab="2"}else e.$Message.warning("请完善数据")}))},handleSubmit:Object(y.a)((function(t){var e=this;this.$refs[t].validate((function(t){if(t){if(e.formValidate.is_label&&!e.dataLabel.length)return e.$Message.warning("请选择用户关联标签");if(parseInt(e.formValidate.is_overlay)&&!e.formValidate.overlay.length)return e.$Message.warning("请选择叠加的营销活动");if(""==e.formValidate.section_time[0])return e.$Message.warning("请选择活动时间");if(4==e.formValidate.product_partake_type&&!e.formValidate.brand_id.length)return e.$Message.error("请添加指定品牌");if(5==e.formValidate.product_partake_type){var r=[];if(e.storeDataLabel.forEach((function(t){r.push(t.id)})),!r.length)return e.$Message.error("请添加指定标签");e.formValidate.store_label_id=r}var n=[];if(e.promotionsData.forEach((function(t){if(null==t.threshold||0==t.threshold)return e.flag=!1,e.$Message.warning("请填写优惠门槛");if(t.checkIntegral&&(null==t.give_integral||0==t.give_integral))return e.flag=!1,e.$Message.warning("请填写赠送积分");if(t.checkCoupon&&!t.giveCoupon.length)return e.flag=!1,e.$Message.warning("请添加优惠券");if(t.checkGoods&&!t.giveProducts.length)return e.flag=!1,e.$Message.warning("请添加赠品");e.flag=!0;var r={threshold:t.threshold,give_integral:0,give_coupon_id:[],give_product_id:[]};t.checkIntegral&&(r.give_integral=t.give_integral),t.checkCoupon&&t.giveCoupon.forEach((function(t){var e={give_coupon_num:t.limit_num,give_coupon_id:t.id};r.give_coupon_id.push(e)})),t.checkGoods&&t.giveProducts.forEach((function(t){var e={give_product_num:t.limit_num,give_product_id:t.product_id,unique:t.unique};r.give_product_id.push(e)})),n.push(r)})),!e.flag)return;var o=[];e.dataLabel.forEach((function(t){o.push(t.id)})),0==e.formValidate.is_label?e.formValidate.label_id=[]:e.formValidate.label_id=o;var i=[];if(e.tableData.forEach((function(t){var e={product_id:t.id,unique:[]};t.attrValue.length&&t.attrValue.forEach((function(t){e.unique.push(t.unique)})),i.push(e)})),2==e.formValidate.product_partake_type&&!i.length)return e.$Message.error("请添加商品");e.formValidate.promotions=n,e.formValidate.product_id=i,Object(a.gb)(4,e.$route.params.id,e.formValidate).then((function(t){e.$router.push({path:"/admin/marketing/discount/give"}),e.$Message.success(t.msg)})).catch((function(t){e.$Message.error(t.msg)}))}else e.$Message.warning("请完善数据")}))}))})},j=(r("7c9c"),Object(v.a)(O,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"form-submit"},[r("div",{staticClass:"i-layout-page-header"},[r("PageHeader",{staticClass:"product_tabs",attrs:{"hidden-breadcrumb":""}},[r("div",{attrs:{slot:"title"},slot:"title"},[r("router-link",{attrs:{to:{path:"/admin/marketing/discount/give"}}},[r("div",{staticClass:"font-sm after-line"},[r("span",{staticClass:"iconfont iconfanhui"}),r("span",{staticClass:"pl10"},[t._v("返回")])])]),r("span",{staticClass:"mr20 ml16",domProps:{textContent:t._s("0"!==t.$route.params.id?"编辑满送活动":"添加满送活动")}})],1)])],1),r("Card",{staticClass:"ivu-mt mb79",attrs:{bordered:!1,"dis-hover":""}},[r("Tabs",{model:{value:t.currentTab,callback:function(e){t.currentTab=e},expression:"currentTab"}},t._l(t.headTab,(function(t,e){return r("TabPane",{key:e,attrs:{label:t.name,name:t.type}})})),1),r("Form",{ref:"formValidate",staticClass:"formValidate mt20",attrs:{rules:t.ruleValidate,model:t.formValidate,"label-width":t.labelWidth,"label-position":t.labelPosition},nativeOn:{submit:function(t){t.preventDefault()}}},[r("Row",{directives:[{name:"show",rawName:"v-show",value:"1"===t.currentTab,expression:"currentTab === '1'"}],attrs:{gutter:24,type:"flex"}},[r("FormItem",{attrs:{label:"条件类型：",props:"coupon_type"}},t._l(t.discountType,(function(e,n){return r("div",{key:n,staticClass:"productType",class:t.formValidate.threshold_type==e.id?"on":"",on:{click:function(r){return t.discountTypeTap(e)}}},[r("div",{staticClass:"name",class:t.formValidate.threshold_type==e.id?"on":""},[t._v("\n                "+t._s(e.name)+"\n              ")]),r("div",{staticClass:"title"},[t._v("("+t._s(e.title)+")")]),t.formValidate.threshold_type==e.id?r("div",{staticClass:"jiao"}):t._e(),t.formValidate.threshold_type==e.id?r("div",{staticClass:"iconfont iconduihao"}):t._e()])})),0),r("Col",{attrs:{span:"24"}},[r("FormItem",{attrs:{label:"活动名称：",prop:"name"}},[r("Input",{directives:[{name:"width",rawName:"v-width",value:"50%",expression:"'50%'"}],attrs:{placeholder:"请输入活动名称"},model:{value:t.formValidate.name,callback:function(e){t.$set(t.formValidate,"name",e)},expression:"formValidate.name"}})],1)],1),r("Col",{attrs:{span:"24"}},[r("FormItem",{attrs:{label:"活动时间：",prop:"section_time"}},[r("div",{staticClass:"acea-row row-middle"},[r("DatePicker",{directives:[{name:"width",rawName:"v-width",value:"50%",expression:"'50%'"}],attrs:{editable:!1,type:"daterange",format:"yyyy-MM-dd",placeholder:"请选择活动时间",value:t.formValidate.section_time},on:{"on-change":t.onchangeTime},model:{value:t.formValidate.section_time,callback:function(e){t.$set(t.formValidate,"section_time",e)},expression:"formValidate.section_time"}})],1)])],1),r("Col",{attrs:{span:"24"}},[r("FormItem",{attrs:{label:"关联标签："}},[r("i-switch",{attrs:{"true-value":1,"false-value":0,size:"large"},model:{value:t.formValidate.is_label,callback:function(e){t.$set(t.formValidate,"is_label",e)},expression:"formValidate.is_label"}},[r("span",{attrs:{slot:"open"},slot:"open"},[t._v("开启")]),r("span",{attrs:{slot:"close"},slot:"close"},[t._v("关闭")])]),t.formValidate.is_label?r("div",{staticClass:"acea-row row-middle mt10"},[r("div",{staticClass:"labelInput acea-row row-between-wrapper",on:{click:t.openLabel}},[r("div",{staticStyle:{width:"90%"}},[t.dataLabel.length?r("div",t._l(t.dataLabel,(function(e,n){return r("Tag",{key:n,attrs:{closable:""},on:{"on-close":function(r){return t.closeLabel(e)}}},[t._v(t._s(e.label_name))])})),1):r("span",{staticClass:"span"},[t._v("选择用户关联标签")])]),r("div",{staticClass:"iconfont iconxiayi"})]),r("span",{staticClass:"addClass",on:{click:t.addLabel}},[t._v("新增标签")])]):t._e()],1)],1),r("Col",{attrs:{span:"24"}},[r("FormItem",{staticStyle:{"margin-bottom":"0"},attrs:{label:"优惠内容：",prop:"promotions_cate"}},[r("RadioGroup",{attrs:{vertical:""},on:{"on-change":t.changeFull},model:{value:t.formValidate.promotions_cate,callback:function(e){t.$set(t.formValidate,"promotions_cate",e)},expression:"formValidate.promotions_cate"}},[r("Radio",{attrs:{label:"1"}},[r("Icon",{attrs:{type:"social-apple"}}),r("span",[t._v("阶梯满送")])],1),r("Radio",{attrs:{label:"2"}},[r("Icon",{attrs:{type:"social-android"}}),r("span",[t._v("循环满送")])],1)],1),r("div",{staticClass:"tips"},[t._v("送赠品循环次数无限制，请注意门槛设置。")])],1),r("FormItem",{attrs:{label:""}},[r("div",{staticClass:"list"},t._l(t.promotionsData,(function(e,n){return r("div",{key:n,staticClass:"item"},[1==t.formValidate.promotions_cate?r("div",{staticClass:"title acea-row row-between-wrapper"},[r("span",[t._v(t._s(n+1)+"级优惠")]),n?r("span",{staticClass:"del",on:{click:function(e){return t.delGrade(n)}}},[t._v("删除")]):t._e()]):t._e(),r("FormItem",{attrs:{label:"优惠门槛："}},[r("span",{staticClass:"mr10"},[2==t.formValidate.promotions_cate?r("span",[t._v("每")]):t._e(),t._v("满")]),1==t.formValidate.threshold_type?r("InputNumber",{staticClass:"width23",attrs:{max:999999,min:0},model:{value:e.threshold,callback:function(r){t.$set(e,"threshold",r)},expression:"item.threshold"}}):r("InputNumber",{staticClass:"width23",attrs:{max:999999,min:0,precision:0},model:{value:e.threshold,callback:function(r){t.$set(e,"threshold",r)},expression:"item.threshold"}}),r("span",{staticClass:"ml10"},[t._v(t._s(1==t.formValidate.threshold_type?"元":"件"))])],1),r("FormItem",{attrs:{label:"优惠内容："}},[r("Checkbox",{model:{value:e.checkIntegral,callback:function(r){t.$set(e,"checkIntegral",r)},expression:"item.checkIntegral"}},[t._v("送")]),r("InputNumber",{staticClass:"width23",attrs:{max:999999,min:0,precision:0},model:{value:e.give_integral,callback:function(r){t.$set(e,"give_integral",r)},expression:"item.give_integral"}}),r("span",{staticClass:"ml10"},[t._v("积分")])],1),r("div",{staticClass:"ml90"},[r("div",{staticClass:"tips"},[t._v("\n                      送积分是订单基础积分上额外赠送，如：订单本身100积分，本次设置送20积分，则该笔订单总共产生120积分。\n                    ")]),r("Checkbox",{model:{value:e.checkCoupon,callback:function(r){t.$set(e,"checkCoupon",r)},expression:"item.checkCoupon"}},[t._v("优惠券")]),e.giveCoupon.length?r("Table",{ref:"table",refInFor:!0,staticClass:"table",attrs:{border:"",columns:t.columns,data:e.giveCoupon,width:"700"},scopedSlots:t._u([{key:"coupon_price",fn:function(e){var n=e.row;return[1==n.coupon_type?r("span",[t._v(t._s(n.coupon_price)+"元")]):t._e(),2==n.coupon_type?r("span",[t._v(t._s(parseFloat(n.coupon_price)/10)+"折（"+t._s(n.coupon_price.toString().split(".")[0])+"%）")]):t._e()]}},{key:"coupon_type",fn:function(e){return[1===e.row.coupon_type?r("span",[t._v("满减券")]):r("span",[t._v("折扣券")])]}},{key:"status",fn:function(e){e.row;var a=e.index;return[r("a",{on:{click:function(e){return t.delCoupon(a,n)}}},[t._v("删除")])]}}],null,!0)}):t._e(),r("div",{staticClass:"bnt",on:{click:function(e){return t.addCoupon(n)}}},[t._v("\n                      + 添加优惠券\n                    ")]),r("Checkbox",{model:{value:e.checkGoods,callback:function(r){t.$set(e,"checkGoods",r)},expression:"item.checkGoods"}},[t._v("赠送商品")]),e.giveProducts.length?r("Table",{ref:"table",refInFor:!0,staticClass:"table",attrs:{border:"",columns:t.colGoods,data:e.giveProducts,width:"700"},scopedSlots:t._u([{key:"coupon_type",fn:function(e){return[1===e.row.coupon_type?r("span",[t._v("满减券")]):r("span",[t._v("折扣券")])]}},{key:"info",fn:function(e){var n=e.row;return[r("div",{staticClass:"imgPic acea-row row-middle"},[r("viewer",[r("div",{staticClass:"pictrue"},[r("img",{directives:[{name:"lazy",rawName:"v-lazy",value:n.image,expression:"row.image"}]})])]),r("div",{staticClass:"info"},[r("Tooltip",{attrs:{"max-width":"200",placement:"bottom"}},[r("span",{staticClass:"line2"},[t._v(t._s(n.store_name)+t._s(n.suk))]),r("p",{attrs:{slot:"content"},slot:"content"},[t._v("\n                                "+t._s(n.store_name)+t._s(n.suk)+"\n                              ")])])],1)],1)]}},{key:"status",fn:function(e){e.row;var a=e.index;return[r("a",{on:{click:function(e){return t.delGoods(a,n)}}},[t._v("删除")])]}}],null,!0)}):t._e(),r("div",{staticClass:"bnt",on:{click:function(e){return t.addGoodsSattr(n)}}},[t._v("\n                      + 添加赠品\n                    ")])],1)],1)})),0),1==t.formValidate.promotions_cate?r("Button",{attrs:{type:"primary"},on:{click:t.addLevel}},[t._v("添加优惠层级")]):t._e(),r("div",{staticClass:"tips"},[t._v("\n                每级优惠不叠加，若满足二级优惠条件后则不再享有一级优惠。\n              ")])],1)],1)],1),r("div",{directives:[{name:"show",rawName:"v-show",value:"2"===t.currentTab,expression:"currentTab === '2'"}]},[r("Row",{staticClass:"mb20",attrs:{gutter:24,type:"flex"}},[r("Col",{attrs:{span:"24"}},[r("RadioGroup",{on:{"on-change":t.goodTap},model:{value:t.formValidate.product_partake_type,callback:function(e){t.$set(t.formValidate,"product_partake_type",e)},expression:"formValidate.product_partake_type"}},[r("Radio",{attrs:{label:1}},[t._v("全部商品参与")]),r("Radio",{attrs:{label:2}},[t._v("指定商品参与")]),r("Radio",{attrs:{label:4}},[t._v("指定品牌参与")]),r("Radio",{attrs:{label:5}},[t._v("指定商品标签参与")])],1)],1),2==t.formValidate.product_partake_type?r("Col",{staticClass:"mt20",attrs:{span:"24"}},[r("Button",{attrs:{type:"primary"},on:{click:t.addGoods}},[t._v("添加商品")])],1):t._e()],1),2==t.formValidate.product_partake_type?r("div",{staticClass:"vxeTable"},[r("vxe-table",{ref:"xTree",attrs:{border:"inner","column-config":{resizable:!0},"row-id":"id","tree-config":{children:"attrValue",reserve:!0},data:t.tableData}},[r("vxe-column",{attrs:{field:"info",title:"商品信息","tree-node":"","min-width":"300"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("div",{staticClass:"imgPic acea-row row-middle"},[r("viewer",[r("div",{staticClass:"pictrue"},[r("img",{directives:[{name:"lazy",rawName:"v-lazy",value:n.image,expression:"row.image"}]})])]),r("div",{staticClass:"info"},[r("Tooltip",{attrs:{"max-width":"200",placement:"bottom",transfer:""}},[r("span",{staticClass:"line2"},[t._v(t._s(n.store_name)+t._s(n.suk))]),r("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(n.store_name)+t._s(n.suk))])])],1)],1)]}}],null,!1,1988674042)}),r("vxe-column",{attrs:{field:"cate_name",title:"商品分类","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("Tooltip",{attrs:{"max-width":"200",placement:"bottom"}},[r("span",{staticClass:"line2"},[t._v(t._s(n.cate_name))]),r("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(n.cate_name))])])]}}],null,!1,3349410013)}),r("vxe-column",{attrs:{field:"store_label",title:"商品标签","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("Tooltip",{attrs:{"max-width":"500",placement:"bottom"}},[r("span",{staticClass:"line2"},[t._v(t._s(n.store_label))]),r("p",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(n.store_label))])])]}}],null,!1,1664260762)}),r("vxe-column",{attrs:{field:"price",title:"售价","min-width":"80"}}),r("vxe-column",{attrs:{field:"cost",title:"成本价","min-width":"80"}}),r("vxe-column",{attrs:{field:"stock",title:"库存","min-width":"80"}}),r("vxe-column",{attrs:{field:"date",title:"操作","min-width":"150",fixed:"right",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[r("a",{on:{click:function(e){return t.del(n)}}},[t._v("删除")])]}}],null,!1,1383043590)})],1)],1):t._e(),4==t.formValidate.product_partake_type?r("FormItem",{attrs:{label:"选择品牌：",required:""}},[r("el-cascader",{directives:[{name:"width",rawName:"v-width",value:"50%",expression:"'50%'"}],attrs:{placeholder:"请选择商品品牌",size:"mini",options:t.brandData,props:t.props,filterable:"",clearable:""},model:{value:t.formValidate.brand_id,callback:function(e){t.$set(t.formValidate,"brand_id",e)},expression:"formValidate.brand_id"}})],1):t._e(),5==t.formValidate.product_partake_type?r("FormItem",{attrs:{label:"选择标签：",required:""}},[r("div",{staticClass:"labelInput acea-row row-between-wrapper",on:{click:t.openStoreLabel}},[r("div",{staticStyle:{width:"90%"}},[t.storeDataLabel.length?r("div",t._l(t.storeDataLabel,(function(e){return r("Tag",{key:e.id,attrs:{closable:""},on:{"on-close":function(r){return t.closeStoreLabel(e)}}},[t._v(t._s(e.label_name))])})),1):r("span",{staticClass:"span"},[t._v("请选择")])]),r("div",{staticClass:"iconfont iconxiayi"})])]):t._e()],1)],1)],1),r("Card",{staticClass:"fixed-card",style:{left:t.menuCollapse?t.isMobile?"0":"80px":"200px"},attrs:{bordered:!1,"dis-hover":""}},[r("Form",[r("FormItem",["1"!==t.currentTab?r("Button",{staticClass:"mr10",on:{click:t.upTab}},[t._v("上一步")]):t._e(),"2"!==t.currentTab?r("Button",{staticClass:"submission",attrs:{type:"primary"},on:{click:function(e){return t.downTab("formValidate")}}},[t._v("下一步")]):r("Button",{staticClass:"submission",attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit("formValidate")}}},[t._v("保存并发布")])],1)],1)],1),r("Modal",{attrs:{scrollable:"",title:"选择用户标签",closable:!0,width:"540","footer-hide":!0,"mask-closable":!1},model:{value:t.labelShow,callback:function(e){t.labelShow=e},expression:"labelShow"}},[r("userLabel",{ref:"userLabel",on:{activeData:t.activeData,close:t.labelClose}})],1),r("Modal",{attrs:{scrollable:"",title:"选择商品标签",closable:!0,width:"540","footer-hide":!0,"mask-closable":!1},model:{value:t.storeLabelShow,callback:function(e){t.storeLabelShow=e},expression:"storeLabelShow"}},[r("storeLabelList",{ref:"storeLabel",on:{activeData:t.activeStoreData,close:t.storeLabelClose}})],1),r("Modal",{staticClass:"paymentFooter",attrs:{title:"商品列表",footerHide:"",scrollable:"",width:"900"},on:{"on-cancel":t.cancel},model:{value:t.modals,callback:function(e){t.modals=e},expression:"modals"}},[t.modals?r("goods-list",{ref:"goodslist",attrs:{ischeckbox:!0,isdiy:!0,product_type:"0,1,3"},on:{getProductId:t.getProductId}}):t._e()],1),r("Modal",{staticClass:"paymentFooter",attrs:{title:"商品列表",footerHide:"",scrollable:"",width:"900"},on:{"on-cancel":t.cancel},model:{value:t.sattrModals,callback:function(e){t.sattrModals=e},expression:"sattrModals"}},[t.sattrModals?r("goods-attr",{ref:"goodSattr",on:{getProductId:t.getAtterId}}):t._e()],1),r("coupon-list",{ref:"couponTemplates",attrs:{discount:!0},on:{getCouponList:t.getCouponList}})],1)}),[],!1,null,"162364dd",null));e.default=j.exports},"5b10":function(t,e,r){"use strict";var n=r("7a86");r.n(n).a},"61f7":function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function o(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach((function(e){i(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function i(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var a=r.call(t,e||"default");if("object"!=n(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function s(t,e){/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));var r={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds()};for(var n in r)if(new RegExp("(".concat(n,")")).test(e)){var a=r[n]+"";e=e.replace(RegExp.$1,1===RegExp.$1.length?a:c(a))}return e}function c(t){return("00"+t).substr(t.length)}r.d(e,"a",(function(){return s})),r.d(e,"c",(function(){return d})),r.d(e,"b",(function(){return f}));var l={min:"%s最小长度为:min",max:"%s最大长度为:max",length:"%s长度必须为:length",range:"%s长度为:range",pattern:"$s格式错误"},u=function(t,e){t.message=function(t){return e.replace("%s",t||"")}};function d(t){return o({required:!0,message:t,type:"string"},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}function f(t){return m.pattern(/(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/,t)}u(d,"请输入%s"),u(f,"%s格式不正确");var m=Object.keys(l).reduce((function(t,e){return t[e]=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a="range"===e?{min:t[0],max:t[1]}:i({},e,t);return o(o({message:r.replace(":".concat(e),"range"===e?"".concat(t[0],"-").concat(t[1]):t),type:"string"},a),n)},u(t[e],l[e]),t}),{})},"7a86":function(t,e,r){},"7c9c":function(t,e,r){"use strict";var n=r("3739");r.n(n).a},b0ee:function(t,e,r){"use strict";var n=r("023d");r.n(n).a},b3cf:function(t,e,r){"use strict";var n=r("d1f5");r.n(n).a},c24f:function(t,e,r){"use strict";r.d(e,"ab",(function(){return a})),r.d(e,"N",(function(){return o})),r.d(e,"M",(function(){return i})),r.d(e,"k",(function(){return s})),r.d(e,"r",(function(){return c})),r.d(e,"d",(function(){return l})),r.d(e,"h",(function(){return u})),r.d(e,"g",(function(){return d})),r.d(e,"q",(function(){return f})),r.d(e,"s",(function(){return m})),r.d(e,"J",(function(){return p})),r.d(e,"P",(function(){return h})),r.d(e,"L",(function(){return b})),r.d(e,"K",(function(){return v})),r.d(e,"f",(function(){return g})),r.d(e,"e",(function(){return _})),r.d(e,"n",(function(){return y})),r.d(e,"S",(function(){return w})),r.d(e,"p",(function(){return k})),r.d(e,"Q",(function(){return x})),r.d(e,"fb",(function(){return C})),r.d(e,"X",(function(){return O})),r.d(e,"V",(function(){return j})),r.d(e,"W",(function(){return L})),r.d(e,"Z",(function(){return S})),r.d(e,"Y",(function(){return V})),r.d(e,"bb",(function(){return T})),r.d(e,"v",(function(){return P})),r.d(e,"w",(function(){return $})),r.d(e,"cb",(function(){return D})),r.d(e,"i",(function(){return I})),r.d(e,"eb",(function(){return E})),r.d(e,"C",(function(){return N})),r.d(e,"gb",(function(){return M})),r.d(e,"m",(function(){return F})),r.d(e,"db",(function(){return G})),r.d(e,"F",(function(){return A})),r.d(e,"B",(function(){return R})),r.d(e,"A",(function(){return B})),r.d(e,"z",(function(){return W})),r.d(e,"D",(function(){return q})),r.d(e,"y",(function(){return z})),r.d(e,"x",(function(){return J})),r.d(e,"u",(function(){return U})),r.d(e,"t",(function(){return H})),r.d(e,"o",(function(){return Y})),r.d(e,"l",(function(){return K})),r.d(e,"G",(function(){return Q})),r.d(e,"I",(function(){return X})),r.d(e,"hb",(function(){return Z})),r.d(e,"O",(function(){return tt})),r.d(e,"E",(function(){return et})),r.d(e,"b",(function(){return rt})),r.d(e,"a",(function(){return nt})),r.d(e,"ib",(function(){return at})),r.d(e,"j",(function(){return ot})),r.d(e,"c",(function(){return it})),r.d(e,"H",(function(){return st})),r.d(e,"T",(function(){return ct})),r.d(e,"U",(function(){return lt})),r.d(e,"R",(function(){return ut}));var n=r("b6bd");function a(t){return Object(n.a)({url:"user/user",method:"get",params:t})}function o(t){return Object(n.a)({url:"setting/config/user/".concat(t),method:"get"})}function i(t,e){return Object(n.a)({url:"setting/config/user/".concat(t),method:"post",data:e})}function s(t){return Object(n.a)({url:"user/user/".concat(t,"/edit"),method:"get"})}function c(t){return Object(n.a)({url:"user/set_status/".concat(t.status,"/").concat(t.id),method:"put"})}function l(t){return Object(n.a)({url:"marketing/coupon/grant",method:"get",params:t})}function u(t){return Object(n.a)({url:"user/edit_other/".concat(t),method:"get"})}function d(t){return Object(n.a)({url:"user/user/".concat(t),method:"get"})}function f(t){return Object(n.a)({url:"user/one_info/".concat(t.id),method:"get",params:t.datas})}function m(t){return Object(n.a)({url:"user/user_level/vip_list",method:"get",params:t})}function p(t){return Object(n.a)({url:"user/user_level/set_show/".concat(t.id,"/").concat(t.is_show),method:"PUT"})}function h(t,e){return Object(n.a)({url:"user/user_level/task/".concat(t),method:"get",params:e})}function b(t){return Object(n.a)({url:"user/user_level/set_task_show/".concat(t.id,"/").concat(t.is_show),method:"PUT"})}function v(t){return Object(n.a)({url:"user/user_level/set_task_must/".concat(t.id,"/").concat(t.is_must),method:"PUT"})}function g(t){return Object(n.a)({url:"/user/user_level/create_task",method:"get",params:t})}function _(t){return Object(n.a)({url:"user/user_level/create",method:"get",params:t})}function y(t){return Object(n.a)({url:"user/give_level/".concat(t),method:"get"})}function w(t){return Object(n.a)({url:"user/user_group/list",method:"get",params:t})}function k(t){return Object(n.a)({url:"user/user_group/add/".concat(t),method:"get"})}function x(t){return Object(n.a)({url:"setting/update_admin",method:"PUT",data:t})}function C(t){return Object(n.a)({url:"user/set_group",method:"post",data:t})}function O(t){return Object(n.a)({url:"user/user_label",method:"get",params:t})}function j(t,e){return Object(n.a)({url:"user/user_label/add/".concat(t),method:"get",params:e})}function L(t){return Object(n.a)({url:"user/user_label_cate/all",method:"get",params:t})}function S(t){return Object(n.a)({url:"user/user_label_cate/".concat(t,"/edit"),method:"get"})}function V(t){return Object(n.a)({url:"user/user_label_cate/create",method:"get"})}function T(t){return Object(n.a)({url:"/user/member_batch/index",method:"get",params:t})}function P(t,e){return Object(n.a)({url:"/user/member_batch/save/".concat(t),method:"post",data:e})}function $(t,e){return Object(n.a)({url:"/user/member_batch/set_value/".concat(t),method:"get",params:e})}function D(t,e){return Object(n.a)({url:"/user/member_card/index/".concat(t),method:"get",params:e})}function I(t,e){return Object(n.a)({url:"/export/memberCard/".concat(t),method:"get",params:e})}function E(){return Object(n.a)({url:"/user/member/ship",method:"get"})}function N(t,e){return Object(n.a)({url:"/user/member_ship/save/".concat(t),method:"post",data:e})}function M(){return Object(n.a)({url:"/user/user/syncUsers",method:"get"})}function F(){return Object(n.a)({url:"/user/user/create",method:"get"})}function G(){return Object(n.a)({url:"/user/member_scan",method:"get"})}function A(t,e){return Object(n.a)({url:"user/label/".concat(t),method:"post",data:e})}function R(t){return Object(n.a)({url:"user/member_right/save/".concat(t.id),method:"post",data:t})}function B(){return Object(n.a)({url:"user/member/right",method:"get"})}function W(t){return Object(n.a)({url:"/user/member/record",method:"get",params:t})}function q(){return Object(n.a)({url:"user/member/ship_select",method:"get"})}function z(t){return Object(n.a)({url:"user/member_card/set_status",method:"get",params:t})}function J(t){return Object(n.a)({url:"user/member_ship/set_ship_status",method:"get",params:t})}function U(t,e){return Object(n.a)({url:"user/member_agreement/save/".concat(t),method:"post",data:e})}function H(){return Object(n.a)({url:"user/member/agreement",method:"get"})}function Y(t){return Object(n.a)({url:"user/give_level_time/".concat(t),method:"get"})}function K(t){return Object(n.a)({url:"user/label/".concat(t),method:"get"})}function Q(t){return Object(n.a)({url:"user/save_set_label",method:"put",data:t})}function X(t){return Object(n.a)({url:"setting/info",method:"get"})}function Z(t){return Object(n.a)({url:"user/visit_list/".concat(t.id),method:"get",params:t.datas})}function tt(t){return Object(n.a)({url:"user/spread_list/".concat(t.id),method:"get",params:t.datas})}function et(t){return Object(n.a)({url:"user/user/".concat(t.uid),method:"put",data:t})}function rt(t,e){return Object(n.a)({url:"agent/set_agent_agreement/".concat(t),method:"post",data:e})}function nt(){return Object(n.a)({url:"agent/get_agent_agreement",method:"get"})}function at(){return Object(n.a)({url:"user/synchro/work/label",method:"get"})}function ot(t){return Object(n.a)({url:"user/user/extend_info/".concat(t),method:"get"})}function it(t){return Object(n.a)({url:"user/batch_process",method:"post",data:t})}function st(t,e){return Object(n.a)({url:"/user/member/save/content/".concat(t),method:"post",data:e})}function ct(t){return Object(n.a)({url:"/user/import_user",method:"post",data:t})}function lt(t){return Object(n.a)({url:"user/import_user/list",method:"get",params:t})}function ut(t){return Object(n.a)({url:"export/importUserExport",method:"get",params:t})}},d1f5:function(t,e,r){},e449:function(t,e,r){"use strict";var n=r("b7be"),a=r("61f7");function o(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var s={name:"index",filters:{formatDate:function(t){if(0!==t){var e=new Date(1e3*t);return Object(a.a)(e,"yyyy-MM-dd hh:mm")}}},props:{couponids:{type:Array},updateIds:{type:Array},updateName:{type:Array},luckDraw:{type:Boolean,default:!1},discount:{type:Boolean,default:!1}},data:function(){return{currentid:0,productRow:{},isTemplate:!1,loading:!1,tableFrom:{type:"send",receive_type:3,page:1,limit:10},total:0,ids:[],texts:[],columns:[{title:"ID",key:"id",width:60},{title:"优惠券名称",key:"title",minWidth:150},{title:"适用类型",slot:"type",minWidth:80},{title:"面值",slot:"coupon_price",minWidth:100},{title:"最低消费额",key:"use_min_price",minWidth:100},{title:"发布数量",slot:"count",minWidth:120},{title:"有效期限",slot:"start_time",minWidth:120},{title:"状态",slot:"status",minWidth:80}],couponList:[],selectedIds:new Set,selectedNames:new Set,couponVal:[]}},mounted:function(){},watch:{updateIds:function(t){this.selectedIds=new Set(t)},updateName:function(t){this.selectedNames=new Set(t)}},created:function(){var t=this,e={width:60,align:"center",render:function(e,r){var n=r.row.id,a=!1;a=t.currentid===n;var o=t;return e("div",[e("Radio",{props:{value:a},on:{"on-change":function(){o.currentid=n,t.productRow=r.row}}})])}};this.luckDraw?this.columns.unshift(e):this.columns.unshift({type:"selection",width:60,align:"center"})},methods:{unique:function(t){var e=new Map;return t.filter((function(t){return!e.has(t.id)&&e.set(t.id,1)}))},changeCheckbox:function(t){this.couponVal=t},handleSelectAll:function(t){var e=this;if(!this.discount){if(0===t.length){var r=this;r.$refs.table.data.forEach((function(t){if(r.selectedIds.has(t.id)){r.selectedIds.delete(t.id);var e=r.unique(Array.from(r.selectedNames));r.unique(Array.from(r.selectedNames)).forEach((function(r,n){r.id===t.id&&e.splice(n,1)})),r.selectedNames=new Set(e)}}))}else t.forEach((function(t){e.selectedIds.add(t.id),e.selectedNames.add({id:t.id,title:t.title})}));this.$nextTick((function(){e.setChecked()}))}},handleSelectRow:function(t,e){var r=this;this.discount||(this.selectedIds.add(e.id),this.selectedNames.add({id:e.id,title:e.title}),this.$nextTick((function(){r.setChecked()})))},handleCancelRow:function(t,e){var r=this;if(!this.discount){this.selectedIds.delete(e.id);var n=Array.from(this.selectedNames);Array.from(this.selectedNames).forEach((function(t,r){t.id===e.id&&n.splice(r,1)})),this.selectedNames=new Set(n),this.$nextTick((function(){r.setChecked()}))}},setChecked:function(){this.ids=o(this.selectedIds),this.texts=o(this.selectedNames);var t=this.$refs.table.objData;for(var e in t)this.selectedIds.has(t[e].id)&&(t[e]._isChecked=!0)},cancel:function(){this.isTemplate=!1,this.luckDraw&&(this.currentid=0)},tableList:function(){var t=this;this.loading=!0,Object(n.db)(this.tableFrom).then((function(e){var r=e.data;t.couponList=r.list,t.discount||t.$nextTick((function(){t.setChecked()})),t.total=r.count,t.loading=!1}))},ok:function(){this.luckDraw?(this.$emit("getCouponId",this.productRow),this.currentid=0):this.discount?this.$emit("getCouponList",this.couponVal):this.$emit("nameId",this.ids,this.texts)},receivePageChange:function(t){this.tableFrom.page=t,this.tableList()}}},c=r("2877"),l=Object(c.a)(s,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("Modal",{attrs:{title:"优惠券列表",width:"60%"},on:{"on-ok":t.ok,"on-cancel":t.cancel},model:{value:t.isTemplate,callback:function(e){t.isTemplate=e},expression:"isTemplate"}},[r("Table",{ref:"table",staticClass:"mt25",attrs:{columns:t.columns,data:t.couponList,loading:t.loading,"highlight-row":"","no-userFrom-text":"暂无数据","no-filtered-userFrom-text":"暂无筛选结果"},on:{"on-select":t.handleSelectRow,"on-select-cancel":t.handleCancelRow,"on-select-all":t.handleSelectAll,"on-select-all-cancel":t.handleSelectAll,"on-selection-change":t.changeCheckbox},scopedSlots:t._u([{key:"coupon_price",fn:function(e){var n=e.row;return[1==n.coupon_type?r("span",[t._v(t._s(n.coupon_price)+"元")]):t._e(),2==n.coupon_type?r("span",[t._v(t._s(parseFloat(n.coupon_price)/10)+"折（"+t._s(n.coupon_price.toString().split(".")[0])+"%）")]):t._e()]}},{key:"count",fn:function(e){var n=e.row;return e.index,[n.is_permanent?r("span",[t._v("不限量")]):r("div",[r("span",{staticClass:"fa"},[t._v("发布："+t._s(n.total_count))]),r("span",{staticClass:"sheng"},[t._v("剩余："+t._s(n.remain_count))])])]}},{key:"start_time",fn:function(e){var n=e.row;return e.index,[n.start_time?r("div",[t._v("\n                        "+t._s(t._f("formatDate")(n.start_time))+" - "+t._s(t._f("formatDate")(n.end_time))+"\n                    ")]):r("span",[t._v("不限时")])]}},{key:"type",fn:function(e){var n=e.row;return[1===n.type?r("span",[t._v("品类券")]):2===n.type?r("span",[t._v("商品券")]):3===n.type?r("span",[t._v("会员券")]):r("span",[t._v("通用券")])]}},{key:"status",fn:function(e){var n=e.row;return e.index,[r("Tag",{directives:[{name:"show",rawName:"v-show",value:1===n.status,expression:"row.status===1"}],attrs:{color:"blue"}},[t._v("正常")]),r("Tag",{directives:[{name:"show",rawName:"v-show",value:0===n.status,expression:"row.status===0"}],attrs:{color:"gold"}},[t._v("未开启")]),r("Tag",{directives:[{name:"show",rawName:"v-show",value:-1===n.status,expression:"row.status=== -1"}],attrs:{color:"red"}},[t._v("已失效")])]}}])}),r("div",{staticClass:"acea-row row-right page"},[r("Page",{attrs:{total:t.total,"show-elevator":"","show-total":"","page-size":t.tableFrom.limit},on:{"on-change":t.receivePageChange}})],1)],1)],1)}),[],!1,null,"d0db60f2",null);e.a=l.exports},f1c7:function(t,e,r){"use strict";var n=r("c4c8"),a={name:"storeLabelList",props:{},data:function(){return{labelList:[],dataLabel:[],isStore:!1}},mounted:function(){},methods:{inArray:function(t,e){for(var r in e)if(e[r].id==t)return!0;return!1},storeLabel:function(t){var e=this;this.dataLabel=t,Object(n.mb)().then((function(t){t.data.map((function(t){t.children&&t.children.length&&(e.isStore=!0,t.children.map((function(t){e.inArray(t.id,e.dataLabel)?t.disabled=!0:t.disabled=!1})))})),e.labelList=t.data})).catch((function(t){e.$Message.error(t.msg)}))},selectLabel:function(t){if(t.disabled){var e=this.dataLabel.indexOf(this.dataLabel.filter((function(e){return e.id==t.id}))[0]);this.dataLabel.splice(e,1),t.disabled=!1}else this.dataLabel.push({label_name:t.label_name,id:t.id}),t.disabled=!0},subBtn:function(){this.$emit("activeData",JSON.parse(JSON.stringify(this.dataLabel)))},cancel:function(){this.$emit("close")}}},o=(r("5b10"),r("2877")),i=Object(o.a)(a,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"label-wrapper"},[r("div",{staticClass:"list-box"},[t._l(t.labelList,(function(e,n){return t.isStore?r("div",{key:n,staticClass:"label-box"},[e.children&&e.children.length?r("div",{staticClass:"title mb-10"},[t._v("\n        "+t._s(e.label_name)+"\n      ")]):t._e(),e.children&&e.children.length?r("div",{staticClass:"list"},t._l(e.children,(function(e,n){return r("div",{key:n,staticClass:"relative label-pro acea-row row-center-wrapper",class:{"active-label":e.disabled},on:{click:function(r){return t.selectLabel(e)}}},[e.icon?r("img",{staticClass:"img-tag",attrs:{src:e.icon}}):r("div",{staticClass:"label-item",style:{backgroundColor:e.bg_color,color:e.color,border:e.border_color?"1px solid "+e.border_color:"none"}},[t._v("\n            "+t._s(e.label_name)+"\n          ")]),r("div",{directives:[{name:"show",rawName:"v-show",value:e.disabled,expression:"label.disabled"}],staticClass:"sanjiao"},[r("span",{staticClass:"iconfont iconwancheng"})])])})),0):t._e()]):t._e()})),t.isStore?t._e():r("div",[t._v("暂无标签")])],2),r("div",{staticClass:"footer"},[r("Button",{on:{click:t.cancel}},[t._v("取消")]),r("Button",{staticClass:"ml14",attrs:{type:"primary"},on:{click:t.subBtn}},[t._v("确定")])],1)])}),[],!1,null,"934076fc",null);e.a=i.exports}}]);